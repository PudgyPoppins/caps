{% extends 'base.html' %}
{% load custom_filters %}
{% load static %}

{% block title %}View {{ nonprofit.title }} logs{% endblock %}

{% block content %}

<h3>Sort</h3>
<div class="button-group sort-by-button-group">
	<button data-sort="day" class="button is-checked">Day Volunteered</button>
	<button data-sort="created_on" class="button">Most Recently Added</button>
</div>

<h3>Filter</h3>
<div class="button-group filters-button-group">
	<button data-filter="*" class="button is-checked">All</button>
	<button data-filter=":not(.processed)" class="button">Unprocessed</button>
	<button data-filter=".verified" class="button">Verified</button>
</div>

<!--<h2>Logs by Day Volunteered</h2>
{% for day in logs_day %}
<h3>{{ day.0.start_date }}</h3>
<ul class="logs">
	{% for l in day %}
	<li class="log {% if l.processed %}processed{% endif %} {% if l.verified %}verfied{% endif %}" data-created_on="{{ l.created_on }}" data-day="{{ l.start_date }}">{{ l.user }} - {{ l.duration | humanize_duration }}</li>
	{% endfor %}
</ul>
{% endfor %}-->

<ul class="logs">
	{% for l in nonprofit.log.all %}
	<li class="log {% if l.processed %}processed{% endif %} {% if l.verified %}verfied{% endif %}" data-created_on="{{ l.created_on|date:'U' }}" data-day="{{ l.start_date|date:"U" }}" id="l.token">
		{{ l.user }} - {{ l.duration | humanize_duration }} <a href="{% url 'logs:detail' l.user.username l.token %}">view details</a> | {% if not l.verified %}<a href="{% url 'logs:verify' l.user.username l.token %}">verify</a>{% else %}<a href="{% url 'logs:unverify' l.user.username l.token %}">unverify</a>{% endif %}{% if not l.processed %} | <a href="#" onclick="deny('{{ l.token }}')" id="anchor{{ l.token }}">deny</a>{% elif not l.verified %} | denied{% endif %}
	
	<div id="reason{{ l.token }}" style="display: none">
		<form method="post" action="{% url 'logs:deny' l.user.username l.token %}">{% csrf_token %}
		    <textarea name="reason" cols="40" rows="2" maxlength="256" required="" id="id_reason" placeholder="Reason for denial"></textarea>
		    <input type="submit" value="Deny">
		</form>
	</div>
	</li>
	{% endfor %}
</ul>

<script src="{% static 'lib/js/isotope.js' %}"></script>
<script>
function deny(id){
	box = document.getElementById("reason" + id);
	link = document.getElementById("anchor" + id);
	box.style.display = "block";
	iso.layout();

	link.innerHTML = "cancel denial";
	link.setAttribute( "onclick", "javascript: cancel_deny('" + id + "');" );
}
function cancel_deny(id){
	box = document.getElementById("reason" + id);
	link = document.getElementById("anchor" + id);
	box.style.display = "none";
	iso.layout();

	link.innerHTML = "deny";
	link.setAttribute( "onclick", "javascript: deny('" + id + "');" );
}

var elem = document.querySelector('.logs');
var iso = new Isotope( elem, {
	// options
	itemSelector: '.log',
	layoutMode: 'vertical',
	getSortData: {
		day: '[data-day] parseInt',
		created_on: '[data-created_on] parseInt',
	}
});

var sortByGroup = document.querySelector('.sort-by-button-group');
sortByGroup.addEventListener( 'click', function( event ) {
	// only button clicks
	if ( !matchesSelector( event.target, '.button' ) ) {
		return;
	}
	var sortValue = event.target.getAttribute('data-sort');
	iso.arrange({ sortBy: sortValue });
});

var filtersElem = document.querySelector('.filters-button-group');
filtersElem.addEventListener( 'click', function( event ) {
	// only work with buttons
	if ( !matchesSelector( event.target, 'button' ) ) {
		return;
	}
	var filterValue = event.target.getAttribute('data-filter');
	iso.arrange({ filter: filterValue });
});

// change is-checked class on buttons
var buttonGroups = document.querySelectorAll('.button-group');
for ( var i=0; i < buttonGroups.length; i++ ) {
	buttonGroups[i].addEventListener( 'click', onButtonGroupClick );
}

function onButtonGroupClick( event ) {
	// only button clicks
	if ( !matchesSelector( event.target, '.button' ) ) {
		return;
	}
	var button = event.target;
	button.parentNode.querySelector('.is-checked').classList.remove('is-checked');
	button.classList.add('is-checked');
}
</script>
<style>
	.is-checked{text-decoration: underline;}
</style>


{% endblock %}