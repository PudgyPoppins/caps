{% extends "base.html" %}

{% block title %}Generate an Invitation Link{% endblock %}

{% block content %}
<a href="{% url 'orgs:detail' organization.slug %}">back to detail view</a>

<h1>Generate an Invitation Link</h1>
<form method="post">{% csrf_token %}
    {{ form.as_p }}
    <input name="expiration" id="f">
    <label for="my_expiration">Expires After:</label>
	<select id="my_expiration" name="my_expiration">
		<option value="never">Never</option>
		<option value="30min">30 minutes</option>
		<option value="1hr">1 hour</option>
		<option value="6hr">6 hours</option>
		<option value="12hr">12 hours</option>
		<option value="1day">1 day</option>
		<option value="1week">1 week</option>
		<option value="1mon">1 month</option>
	</select>
    <input type="submit" value="Save">
</form>

<script>
function dateAdd(date, interval, units) {
  if(!(date instanceof Date))
    return undefined;
  var ret = new Date(date); //don't change original date
  var checkRollover = function() { if(ret.getDate() != date.getDate()) ret.setDate(0);};
  switch(String(interval).toLowerCase()) {
    case 'year'   :  ret.setFullYear(ret.getFullYear() + units); checkRollover();  break;
    case 'quarter':  ret.setMonth(ret.getMonth() + 3*units); checkRollover();  break;
    case 'month'  :  ret.setMonth(ret.getMonth() + units); checkRollover();  break;
    case 'week'   :  ret.setDate(ret.getDate() + 7*units);  break;
    case 'day'    :  ret.setDate(ret.getDate() + units);  break;
    case 'hour'   :  ret.setTime(ret.getTime() + units*3600000);  break;
    case 'minute' :  ret.setTime(ret.getTime() + units*60000);  break;
    case 'second' :  ret.setTime(ret.getTime() + units*1000);  break;
    default       :  ret = undefined;  break;
  }
  return ret;
}

document.getElementById('my_expiration')
    .addEventListener('blur', function (event) {
		var delta = document.getElementById("my_expiration").value;
		console.log(delta);
		if(delta=="never"){
			document.getElementById("f").value = "yeet";
		}
		else if(delta=="30min"){document.getElementById("f").value = dateAdd(new Date(), 'minute', 30);}
    });
</script>
{% endblock %}