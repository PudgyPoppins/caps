<!--This is where the calendar, with all of its events, will go-->
{% load static %}
{% load custom_filters %}
<script src="{% static 'cal/rrule.js' %}"></script>

<script src="{% static 'cal/fullcalendar.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'cal/fullcalendar.css' %}">
<script src="{% static 'cal/daygrid.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'cal/daygrid.css' %}">
<script src="{% static 'cal/list.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'cal/list.css' %}">
<script src="{% static 'cal/timegrid.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'cal/timegrid.css' %}">

<script src="{% static 'cal/rrulefullcalendar.js' %}"></script>

{% if type == "user" %}
<a href="{% url 'cal:addevent' profile.username %}">add an event</a>
{% elif type == "nonprofit" %}
<a href="{% url 'cal:addevent' nonprofit.network.slug nonprofit.slug %}">add an event</a>
{% elif type == "network" %}
<a href="{% url 'cal:addevent' network.slug %}">add an event</a>
{% elif type == "organization" %}
<a href="{% url 'cal:add_event_org' organization.slug %}">add an event</a>
{% endif %}

<div id="calendar"></div>

<script>
  var dateFormat = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute:'numeric' };

  document.addEventListener('DOMContentLoaded', function() {
	var calendarEl = document.getElementById('calendar');
	var modal = document.getElementById("eventModal");

	var calendar = new FullCalendar.Calendar(calendarEl, {
		allDayDefault: false,
		eventLimit: true,
		plugins: [ 'dayGrid', 'list', 'rrule', 'timeGrid' ],
		header: {
		  left: 'prev,next today',
		  center: 'title',
		  right: 'dayGridMonth,timeGridWeek,listDay'
		},
		eventClick: function(info) {
		  document.getElementById("modalTime").innerHTML = "";

		  var eventObj = info.event;
		  modal.style.display = "block";
		  document.getElementById("modalTitle").innerHTML = eventObj.title;
		  document.getElementById("modalDescription").innerHTML = eventObj.extendedProps.description;
		  document.getElementById("modalDetail").setAttribute("href", "{% url 'cal:eventdetail' %}" + eventObj.extendedProps.token);
		  if(! eventObj.allDay){document.getElementById("modalTime").innerHTML = eventObj.start.toLocaleDateString("en-US", dateFormat) + " - " + eventObj.end.toLocaleDateString("en-US", dateFormat);}
		  else{document.getElementById("modalTime").innerHTML = "This is an all day event.";}
		},
		events: {
			url: '{% url "cal:caljson" calendar.token %}',
		    cache: true
		}
	});

	calendar.render();
  });

</script>


<div id="eventModal" class="modal">
  <div class="modal-content eventmodal">
    <span class="close">&times;</span>
    <h1 id="modalTitle">Event title</h1>
    <p id="modalTime">Time</p>
    <p id="modalDescription">Description</p>
    <a id="modalDetail" href="">More information</a>
  </div>
</div>

<script>
	var modal = document.getElementById("eventModal");
	var span = document.getElementsByClassName("close")[0];
	span.onclick = function() {
	  modal.style.display = "none";
	}
	window.onclick = function(event) {
	  if (event.target == modal) {
	    modal.style.display = "none";
	  }
	} 
</script>